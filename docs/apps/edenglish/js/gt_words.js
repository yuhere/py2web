function __init__(e){function t(e,t){t=void 0===t?"yyyy-MM-dd hh:mm:ss":t;var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in n){RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[i]:("00"+n[i]).substr((""+n[i]).length)))}return t}function n(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function i(e,t,n){return"<"+e+' class="'+t+'">'+n+"</"+e+">"}function isChinese(str) {return /[\u4E00-\u9FA5\uF900-\uFA2D]/.test(str)}function a(e,t){t=void 0===t?"c":t;for(var a=[],s=0;s<e.length;s++){var cc = e.charAt(s);a.push(i("span",t + (isChinese(cc) ? " cc" : ""),n(cc)))}return a.join("")}function s(e){for(var t,n=[],s=/([a-z0-9]+)/gi,r=0;null!==(t=s.exec(e));){t.index===s.lastIndex&&s.lastIndex++;var o=t[1],l=e.substring(r,t.index);r=t.index+t[0].length,n.push(a(l)),n.push(i("span","w",a(o)))}return n.push(a(e.substring(r))),n.join("")}function r(e,t){for(var n=[],s=[],r=0;r<e.length;r++){var o=" w"+t+"c"+r,l=e.charCodeAt(r);n.push(a(e.charAt(r),"c s")),s.push(a(" ","c s"+(97>l||l>122?65>l||l>90?"":" u":" l")+o))}return{span:i("span","w spw"+t,n.join("")),input:i("span","w w"+t,s.join(""))}}function o(e){for(var t,i,a=y.split(/\r?\n/g),o=[],l=[],d=[],c=[],u=0;u<a.length;u++){var v=a[u];o.push("<p>"),d.push("<p>");for(var f,h=/\<w\>(.*?)\<\/w\>/gi,p=0;null!==(f=h.exec(v));){f.index===h.lastIndex&&h.lastIndex++;var g=f[1],m=v.substring(p,f.index);t=s(m),i=r(g,l.length),o.push(t+i.input),d.push(t+i.span),l.push(g.split("")),p=f.index+f[0].length}t=s(v.substring(p)),o.push(t),d.push(t),o.push("</p>\n"),d.push("</p>\n")}if(l.length>0){c.push("<table>"),c.push("<tr>"),c.push('<td colspan="2">Dictionary:</td>'),c.push("</tr>");for(var u=0;u<l.length;u++){var g=l[u].join(""),L=g;c.push("<tr>"),c.push('<td style="white-space: nowrap;"><button class="dic_btn_play">\ud83d\udd0a</button>'+L+"</td>"),c.push("<td>"),b.hasOwnProperty(L)?c.push(n(b[L].translation+"")):c.push(n("** MISS **")),c.push("</td>"),c.push("</tr>")}c.push("</table>")}return{question:o.join(""),answer:d.join(""),dict:c.join(""),words:l}}function l(e){e=void 0===e?"normal":e,function(){var s=document.getElementById("question"),r=document.getElementById("answer"),o=document.getElementById("dict"),d=["normal","exam","finish"],c=d.indexOf(e);d.splice(c,1);for(var u=0;u<d.length;u++){s.classList.contains(d[u])&&s.classList.remove(d[u]),r.classList.contains(d[u])&&r.classList.remove(d[u]),o.classList.contains(d[u])&&o.classList.remove(d[u])}!s.classList.contains(e)&&s.classList.add(e),!r.classList.contains(e)&&r.classList.add(e),!o.classList.contains(e)&&o.classList.add(e);var v=document.getElementById("header"),f=document.getElementById("qheader");if("normal"===e){v.innerHTML='<div><button id="btn_print">\ud83d\udda8\ufe0f</button><button id="btn_exam">\ud83c\udf93</button></div>',f.innerHTML="",f.style.visibility="hidden";var h=document.getElementById("btn_print"),p=document.getElementById("btn_exam");h.addEventListener("click",function(e){window.print()}),p.addEventListener("click",function(e){l("exam")})}else{if("exam"===e){v.innerHTML='<div><button id="btn_submit">\u2705</button><button id="btn_cancel">\u274e</button></div>',f.innerHTML='<div class="status"><span id="ir_count"></span><span id="remaining">\u231b00:00:00</span></div>',f.style.visibility="visible";var g=document.getElementById("btn_submit"),y=document.getElementById("btn_cancel");g.addEventListener("click",function(e){var s=m()?"\u662f\u5426\u8981\u63d0\u4ea4\uff1f":"\u770b\u6837\u5b50\u8fd8\u6ca1\u6709\u7b54\u5b8c\uff0c\u786e\u8ba4\u8981\u63d0\u4ea4\u5417\uff1f";confirm(s)&&(n&&clearInterval(n),n=void 0,L(),g.remove(),i.innerHTML="\u23f1"+t(new Date(a),"yyyy-MM-dd hh:mm")+" ~ "+t(new Date,"hh:mm"),l("finish"),setTimeout(function(){window.print()},100))}),y.addEventListener("click",function(e){"finish"===k?l("normal"):confirm("\u6d4b\u8bd5\u770b\u6837\u5b50\u8fd8\u6ca1\u6709\u7ed3\u675f\uff0c\u786e\u8ba4\u8981\u53d6\u6d88\u5417\uff1f")&&(n&&clearInterval(n),n=void 0,l("normal"))})}else{if("finish"===e){v.innerHTML='<div><button id="btn_back">\ud83d\udd19</button><button id="btn_reload">\ud83d\udd03</button></div>';var b=document.getElementById("btn_back"),y=document.getElementById("btn_cancel");b.addEventListener("click",function(e){l("normal")}),btn_reload.addEventListener("click",function(e){l("exam")})}}}}();var n,i=document.getElementById("remaining"),a=(new Date).getTime();"normal"===e?g():"exam"===e&&(g(),n=setInterval(function(){var e=Math.floor(((new Date).getTime()-a)/1e3),t=[];t.push((""+Math.floor(e/3600)).padStart(2,"0")),e%=3600,t.push((""+Math.floor(e/60)).padStart(2,"0")),e%=60,t.push((""+e).padStart(2,"0")),i.innerHTML="\u231b"+t.join(":")},1e3),v("w0c0")),k=e}function d(e){u()}function c(e){}function u(){var e=/w([0-9]+)c([0-9]+)/.exec(I),t=parseInt(e[1]),n=(parseInt(e[2]),E[t].join(""));b[n]&&b[n].audio&&w(b[n].audio)}function v(e){if(void 0===e){if(void 0!==I){var t=/w([0-9]+)c([0-9]+)/.exec(I),n=parseInt(t[1]),i=parseInt(t[2]),a=M[n][i],s=a.firstChild;s.nodeValue=_.value,_.remove(),a.classList.contains("f")&&a.classList.remove("f");var r=_.getAttribute("onchanging");null===r?c(n):_.removeAttribute("onchanging"),I=void 0}return!0}if(void 0===I){var o=/w([0-9]+)c([0-9]+)/.exec(e),l=parseInt(o[1]),u=parseInt(o[2]),v=M[l][u],f=v.firstChild;return _.value=f.nodeValue,_.classList.remove("l"),_.classList.remove("u"),v.classList.contains("l")&&_.classList.add("l"),v.classList.contains("u")&&_.classList.add("u"),!v.classList.contains("f")&&v.classList.add("f"),v.appendChild(_),_.focus(),I=e,d(l),!0}if(I===e){return _.selectionStart=0,_.selectionEnd=0,!1}var t=/w([0-9]+)c([0-9]+)/.exec(I),n=parseInt(t[1]),i=parseInt(t[2]),a=M[n][i],s=document.createTextNode(_.value||" "),o=/w([0-9]+)c([0-9]+)/.exec(e),l=parseInt(o[1]),u=parseInt(o[2]),v=M[l][u],f=v.firstChild;return _.setAttribute("onchanging","true"),_.blur(),n!==l&&c(n),_.value=f.nodeValue,_.classList.remove("l"),_.classList.remove("u"),v.classList.contains("l")&&_.classList.add("l"),v.classList.contains("u")&&_.classList.add("u"),!v.classList.contains("f")&&v.classList.add("f"),v.appendChild(_),_.focus(),I=e,n!==l&&d(l),!0}function f(e){function t(e){e=void 0===e?0:e;var t,n=/w([0-9]+)c([0-9]+)/.exec(I),i=parseInt(n[1]),a=parseInt(n[2])+(0===e?0:e>0?1:-1);if(0===e){return I}if(e>0){for(var s=i;s>=0&&s<M.length&&void 0===t;s++){for(var r=M[s],o=s===i?a:0;o>=0&&o<r.length&&void 0===t;o++){t="w"+s+"c"+o}}return void 0===t&&(t="w0c0"),t}if(0>e){for(var s=i;s>=0&&s<M.length&&void 0===t;s--){for(var r=M[s],o=s===i?a:r.length-1;o>=0&&o<r.length&&void 0===t;o--){t="w"+s+"c"+o}}return void 0===t&&(t="w"+(M.length-1)+"c"+(M[M.length-1].length-1)),t}}v(t(e))}function h(e){function t(e){e=void 0===e?0:e;var t,n=/w([0-9]+)c([0-9]+)/.exec(I),i=parseInt(n[1])+(0===e?0:e>0?1:-1);if(0===e){return I}if(e>0){for(var a=i;a>=0&&a<M.length&&void 0===t;a++){t="w"+a+"c0"}return void 0===t&&(t="w0c0"),t}if(0>e){for(var a=i;a>=0&&a<M.length&&void 0===t;a--){t="w"+a+"c0"}return void 0===t&&(t="w"+(M.length-1)+"c0"),t}}v(t(e))}function p(e){if(void 0!==I){var t=/w([0-9]+)c([0-9]+)/.exec(I),n=parseInt(t[1]),i=parseInt(t[2]);if("char"===e){var a=M[n][i].firstChild,s=a&&a.nextSibling;a.nodeValue=E[n][i],s&&(s.value=E[n][i])}else{if("word"===e){for(var r=E[n],o=0;o<r.length;o++){var a=M[n][o].firstChild,s=a&&a.nextSibling;a.nodeValue=r[o],s&&(s.value=r[o])}}else{if("part"===e){for(var r=E[n],o=0;o<r.length;o++){if(-1!==["a","e","i","o","u"].indexOf(r[o].toLowerCase())){var a=M[n][o].firstChild,s=a&&a.nextSibling;a.nodeValue=r[o],s&&(s.value=r[o])}}}}}}}function g(){v();for(var e=0;e<M.length;e++){for(var t=0;t<M[e].length;t++){var n=M[e][t].firstChild,i=document.createTextNode(" ");M[e][t].replaceChild(i,n),M[e][t].classList.contains("x")&&M[e][t].classList.remove("x")}}m()}function m(){for(var e=0,t=0,n=M.length,i=0,a=document.getElementById("ir_count"),s=0;s<M.length;s++){for(var r=0,o=0;o<M[s].length;o++){e+=1;var l=M[s][o].firstChild,d=3!==l.nodeType?l.value:l.nodeValue;" "!==d&&(t+=1,r+=1)}r===M[s].length&&(i+=1)}return a&&(a.innerHTML="\ud83d\udcdd"+(i+"/"+n+","+t+"/"+e)),i===n}function L(){for(var e=0,t=0,n=M.length,i=0,a=document.getElementById("ir_count"),s=0;s<M.length;s++){for(var r=0,o=0;o<M[s].length;o++){e+=1;var l=M[s][o].firstChild,d=3!==l.nodeType?l.value:l.nodeValue;d.toLowerCase()===E[s][o].toLowerCase()?(t+=1,r+=1,M[s][o].classList.contains("x")&&M[s][o].classList.remove("x")):!M[s][o].classList.contains("x")&&M[s][o].classList.add("x")}r===M[s].length&&(i+=1)}console.log("check result: words count: ",i+" / "+n+", chars count: ",t+" / "+e);var c=Math.floor(100*i/n),u=Math.floor(100*t/e);a&&(a.innerHTML="\ud83d\udccb"+(i+"/"+n+"="+c+"%"+(80>c?"\ud83d\udc4e":"\ud83d\udc4d")+","+t+"/"+e+"="+c+"%"+(80>u?"\ud83d\udc4e":"\ud83d\udc4d")))}var y=e.marked,b=e.dict,w=(e.qid,function(){var e=new Audio,t=!1;if(/i(Phone|P(o|a)d)/.test(navigator.userAgent)){var n=function(){return e.load(),t=!0,!1};document.addEventListener("touchstart",n)}else{t=!0}return function(n){t&&(e.pause(),e.src=n,e.play())}}()),x=o(),E=x.words,C='<div id="header" class="ctl"></div><div id="question" class="block"><div id="qheader" class="block"></div><div>'+x.question+'</div></div><div id="answer" class="block"><div>'+x.answer+'</div></div><div id="dict" class="block">'+x.dict+"</div>";document.getElementById("main").innerHTML=C,function(){for(var e=document.getElementsByClassName("dic_btn_play"),t=0;t<e.length;t++){e[t].addEventListener("click",function(e){var t=e.target,n=t.nextSibling,i=n.nodeValue;w(b[i].audio)})}}();var I,k="normal",M=E.map(function(e,t){var n=document.getElementsByClassName("spw"+t)[0];return n.addEventListener("mousedown",function(t){if("normal"===k){var n=e.join("");b[n]&&b[n].audio&&w(b[n].audio)}}),e.map(function(e,n){var i="w"+t+"c"+n,a=document.getElementsByClassName(i)[0];return a.addEventListener("mousedown",function(e){"exam"===k&&(v(i),e.preventDefault(),e.stopPropagation())}),a})}),_=function(){var e=document.createElement("input");e.classList.add("i"),e.setAttribute("maxlength","1"),e.value=" ",e.addEventListener("input",function(n){n.target.value;t&&""!==e.value||(e.value=" ",e.selectionStart=0,e.selectionEnd=0),m()});var t=!1;return e.addEventListener("keydown",function(n){if(t=!0,8===n.keyCode){e.value=" ",f(-1),m()}else{if(38===n.keyCode){h(-1)}else{if(40===n.keyCode){h(1)}else{if(37===n.keyCode){f(-1)}else{if(39===n.keyCode){f(1)}else{if(46===n.keyCode){e.value=" ",e.selectionStart=0,e.selectionEnd=0,m()}else{if(32===n.keyCode){e.value=" ",f(1),m()}else{if(9===n.keyCode||13===n.keyCode){if(n.ctrlKey){var i=document.getElementById("btn_submit");i&&i.focus()+i.click()}else{f(n.shiftKey?-1:1)}}else{n.ctrlKey||n.altKey||n.metaKey||(n.keyCode<65||n.keyCode>90)&&(n.keyCode<97||n.keyCode>122)?-1!==[186].indexOf(n.keyCode)?u():188===n.keyCode?u():190===n.keyCode?(p("word"),m()):191===n.keyCode?(p("part"),m()):t=!1:(e.value=String.fromCharCode(n.keyCode),f(1),m())}}}}}}}}n.preventDefault(),n.stopPropagation()}),e.addEventListener("focus",function(t){e.selectionStart=0,e.selectionEnd=0}),e.addEventListener("blur",function(e){v()}),e}();l()}
